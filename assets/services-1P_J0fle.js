import{I as m,d as p,e as y,f as g,g as f,h as w,i as I,j as A,k as S,l as v}from"./types-BEe6FBee.js";import{aZ as T,a_ as l}from"./vendor-BadBNqqM.js";const b=async n=>{const t=new TextEncoder().encode(n+"luxestay_salt_2024"),s=await crypto.subtle.digest("SHA-256",t);return Array.from(new Uint8Array(s)).map(r=>r.toString(16).padStart(2,"0")).join("")},E=async(n,e)=>await b(n)===e,x=n=>/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(n),N=n=>{const e=[];return n.length<8&&e.push("Password must be at least 8 characters long"),/[A-Z]/.test(n)||e.push("Password must contain at least one uppercase letter"),/[a-z]/.test(n)||e.push("Password must contain at least one lowercase letter"),/\d/.test(n)||e.push("Password must contain at least one number"),/[!@#$%^&*]/.test(n)||e.push("Password must contain at least one special character (!@#$%^&*)"),{isValid:e.length===0,errors:e}},C=n=>n.replace(/[<>]/g,"").trim();class _{constructor(){this.currentUser=null,this.sessionTimeout=480*60*1e3}async login(e,t,s){if(!x(e))return{success:!1,error:"Invalid email format"};if(!N(t).isValid)return{success:!1,error:"Password does not meet security requirements"};const r=s.find(i=>i.email===e);return!r||!r.password?{success:!1,error:"Invalid credentials"}:await E(t,r.password)?(this.currentUser=r,this.setSession(r),{success:!0,user:r}):{success:!1,error:"Invalid credentials"}}logout(){this.currentUser=null,this.clearSession()}getCurrentUser(){return this.currentUser}isAuthenticated(){const e=this.getSession();return e?Date.now()-e.timestamp>this.sessionTimeout?(this.clearSession(),!1):!0:!1}setSession(e){if(typeof window>"u"||!window.localStorage)return;const t={userId:e.id,timestamp:Date.now(),role:e.permissionRole};localStorage.setItem("luxestay_session",JSON.stringify(t))}getSession(){if(typeof window>"u"||!window.localStorage)return null;const e=localStorage.getItem("luxestay_session");if(!e)return null;try{return JSON.parse(e)}catch{return null}}clearSession(){typeof window>"u"||!window.localStorage||localStorage.removeItem("luxestay_session")}async encryptData(e){const s=new TextEncoder().encode(e),o=await crypto.subtle.generateKey({name:"AES-GCM",length:256},!0,["encrypt","decrypt"]),r=crypto.getRandomValues(new Uint8Array(12)),a=await crypto.subtle.encrypt({name:"AES-GCM",iv:r},o,s),i=await crypto.subtle.exportKey("raw",o),u=new Uint8Array(i),c=new Uint8Array(r.length+u.length+a.byteLength);return c.set(r,0),c.set(u,r.length),c.set(new Uint8Array(a),r.length+u.length),btoa(String.fromCharCode(...c))}async decryptData(e){try{const t=new Uint8Array(atob(e).split("").map(c=>c.charCodeAt(0))),s=t.slice(0,12),o=t.slice(12,44),r=t.slice(44),a=await crypto.subtle.importKey("raw",o,{name:"AES-GCM",length:256},!1,["decrypt"]),i=await crypto.subtle.decrypt({name:"AES-GCM",iv:s},a,r);return new TextDecoder().decode(i)}catch{throw new Error("Failed to decrypt data")}}}const h=new _;class R{constructor(){this.data={rooms:v,bookings:S,guests:A,categories:I,tasks:w,templates:f,staff:g,feedback:y,emails:[],notifications:[],conversations:p,menu:m}}async getAll(e){return this.data[e]}async getById(e,t){return this.data[e].find(o=>o.id===t)}async create(e,t){return this.data[e].push(t),t}async update(e,t,s){if(!h.isAuthenticated())throw new Error("Authentication required");const o=this.sanitizeItem(s),r=this.data[e],a=r.findIndex(i=>i.id===t);if(a!==-1)return r[a]={...r[a],...o},r[a]}async updateCollection(e,t){if(!h.isAuthenticated())throw new Error("Authentication required");const s=t.map(o=>this.sanitizeItem(o));this.data[e]=s}async delete(e,t){if(!h.isAuthenticated())throw new Error("Authentication required");const s=this.data[e],o=s.findIndex(r=>r.id===t);return o!==-1?(s.splice(o,1),!0):!1}sanitizeItem(e){const t={...e};return Object.keys(t).forEach(s=>{typeof t[s]=="string"&&(t[s]=C(t[s]))}),t}}const P=new R,d=new T({apiKey:"PLACEHOLDER_API_KEY"}),k=async n=>{try{const e=n.messages.slice(-5).map(s=>`${s.sender}: ${s.text}`).join(`
`),t=await d.models.generateContent({model:"gemini-3-flash-preview",contents:`
        You are a luxury hotel front desk AI assistant.
        Analyze this conversation between a guest and the hotel:
        ${e}

        Provide 3 short, professional suggested replies for the staff to send back to the guest.
        Format your response as a simple JSON array of strings.
      `,config:{responseMimeType:"application/json"}});return JSON.parse(t.text)}catch(e){return console.error("Gemini Suggestions Error:",e),["Sure, I can help with that.","I will check on that for you.","Is there anything else I can assist you with?"]}},L=async n=>{try{return(await d.models.generateContent({model:"gemini-3-flash-preview",contents:`Translate the following text into English. If it is already in English, just return the original text. Text: "${n}"`})).text}catch{return n}},G={name:"request_hotel_service",parameters:{type:l.OBJECT,description:"Request a specific hotel service (cleaning, towels, maintenance, etc.) for a guest room.",properties:{roomNumber:{type:l.STRING,description:"The room number requesting the service."},serviceType:{type:l.STRING,enum:["cleaning","maintenance","towel","pillows","other"],description:"Type of service requested."},details:{type:l.STRING,description:"Specific details about the request."},priority:{type:l.STRING,enum:["low","medium","high"],description:"Urgency of the request."}},required:["roomNumber","serviceType","details"]}},U=async(n,e)=>{try{const t=await d.models.generateContent({model:"gemini-3-flash-preview",contents:`
        You are the LuxeStay Digital Concierge. You assist guests with their stay.
        
        Hotel Information:
        - Current Available Room Types: ${JSON.stringify(e.categories)}
        - Total Rooms Available for Booking: ${e.availableRooms}
        - Dining Menu: ${JSON.stringify(e.menu)}

        Your Goal:
        - Help guests book rooms.
        - Answer questions about amenities (WiFi is free, all rooms have Smart TVs).
        - Help guests order food from the menu.
        - Help guests request services (like extra towels or room cleaning).

        If a guest wants to order food, describe the items from the menu.
        If a guest wants to request a service (towels, cleaning, etc.), use the request_hotel_service tool.

        Guest Message: "${n}"
      `,config:{tools:[{functionDeclarations:[G]}]}});return{text:t.text,functionCalls:t.functionCalls}}catch(t){return console.error("Guest AI Error:",t),{text:"I'm here to help! What can I do for you today?"}}},D=async(n,e)=>{try{const t=`
      You are a Revenue Management Consultant for a luxury hotel.
      Analyze the following data and provide a concise pricing strategy for the next 7 days.
      Room Categories: ${JSON.stringify(n)}
      Recent Bookings: ${JSON.stringify(e.slice(0,10))}

      Provide 3 actionable bullet points for pricing adjustments (e.g., increase suite rates by 10% for high demand).
      Keep it professional and focused on yield management.
    `;return(await d.models.generateContent({model:"gemini-3-flash-preview",contents:t})).text}catch{return"Analyze current occupancy trends and consider dynamic pricing for high-demand suite categories."}};export{h as a,k as b,U as c,P as d,D as g,L as t};
